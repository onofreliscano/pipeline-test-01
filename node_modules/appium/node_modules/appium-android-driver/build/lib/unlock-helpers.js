"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.helpers = exports.FINGERPRINT_UNLOCK = exports.PATTERN_UNLOCK = exports.PASSWORD_UNLOCK = exports.PIN_UNLOCK_KEY_EVENT = exports.PIN_UNLOCK = void 0;

require("source-map-support/register");

var _logger = _interopRequireDefault(require("./logger"));

var _asyncbox = require("asyncbox");

var _lodash = _interopRequireDefault(require("lodash"));

var _appiumSupport = require("appium-support");

const PIN_UNLOCK = 'pin';
exports.PIN_UNLOCK = PIN_UNLOCK;
const PIN_UNLOCK_KEY_EVENT = 'pinWithKeyEvent';
exports.PIN_UNLOCK_KEY_EVENT = PIN_UNLOCK_KEY_EVENT;
const PASSWORD_UNLOCK = 'password';
exports.PASSWORD_UNLOCK = PASSWORD_UNLOCK;
const PATTERN_UNLOCK = 'pattern';
exports.PATTERN_UNLOCK = PATTERN_UNLOCK;
const FINGERPRINT_UNLOCK = 'fingerprint';
exports.FINGERPRINT_UNLOCK = FINGERPRINT_UNLOCK;
const UNLOCK_TYPES = [PIN_UNLOCK, PIN_UNLOCK_KEY_EVENT, PASSWORD_UNLOCK, PATTERN_UNLOCK, FINGERPRINT_UNLOCK];
const KEYCODE_NUMPAD_ENTER = 66;
const KEYCODE_POWER = 26;
const KEYCODE_WAKEUP = 224;
const UNLOCK_WAIT_TIME = 100;
const HIDE_KEYBOARD_WAIT_TIME = 100;
const INPUT_KEYS_WAIT_TIME = 100;
const NUMBER_ZERO_KEYCODE = 7;
let helpers = {};
exports.helpers = helpers;

helpers.isValidUnlockType = function isValidUnlockType(type) {
  return UNLOCK_TYPES.includes(type);
};

helpers.isValidKey = function isValidKey(type, key) {
  if (_lodash.default.isUndefined(key)) {
    return false;
  }

  if ([PIN_UNLOCK, PIN_UNLOCK_KEY_EVENT, FINGERPRINT_UNLOCK].includes(type)) {
    return /^[0-9]+$/.test(key.trim());
  }

  if (type === PATTERN_UNLOCK) {
    if (!/^[1-9]{2,9}$/.test(key.trim())) {
      return false;
    }

    return !/([1-9]).*?\1/.test(key.trim());
  }

  if (type === PASSWORD_UNLOCK) {
    return /.{4,}/g.test(key);
  }

  throw new Error(`Invalid unlock type ${type}`);
};

helpers.dismissKeyguard = async function dismissKeyguard(driver, adb) {
  _logger.default.info('Waking up the device to unlock it');

  await driver.pressKeyCode(KEYCODE_POWER);
  await driver.pressKeyCode(KEYCODE_WAKEUP);
  let isKeyboardShown = await driver.isKeyboardShown();

  if (isKeyboardShown) {
    await driver.hideKeyboard();
    await (0, _asyncbox.sleep)(HIDE_KEYBOARD_WAIT_TIME);
  }

  _logger.default.info('Dismiss notifications from unlock view');

  await adb.shell(['service', 'call', 'notification', '1']);
  await adb.back();

  if ((await adb.getApiLevel()) > 21) {
    _logger.default.info('Trying to dismiss keyguard');

    await adb.shell(['wm', 'dismiss-keyguard']);
    return;
  }

  _logger.default.info('Swiping up to dismiss keyguard');

  await helpers.swipeUp(driver);
};

helpers.swipeUp = async function swipeUp(driver) {
  let windowSize = await driver.getWindowSize();
  let x0 = parseInt(windowSize.x / 2, 10);
  let y0 = windowSize.y - 10;
  let yP = 100;
  let actions = [{
    action: 'press',
    options: {
      element: null,
      x: x0,
      y: y0
    }
  }, {
    action: 'moveTo',
    options: {
      element: null,
      x: x0,
      y: yP
    }
  }, {
    action: 'release'
  }];
  await driver.performTouch(actions);
};

helpers.encodePassword = function encodePassword(key) {
  return key.replace(/\s/ig, '%s');
};

helpers.stringKeyToArr = function stringKeyToArr(key) {
  return key.trim().replace(/\s+/g, '').split(/\s*/);
};

helpers.fingerprintUnlock = async function fingerprintUnlock(adb, driver, capabilities) {
  if ((await adb.getApiLevel()) < 23) {
    throw new Error('Fingerprint unlock only works for Android 6+ emulators');
  }

  await adb.fingerprint(capabilities.unlockKey);
  await (0, _asyncbox.sleep)(UNLOCK_WAIT_TIME);
};

helpers.pinUnlock = async function pinUnlock(adb, driver, capabilities) {
  _logger.default.info(`Trying to unlock device using pin ${capabilities.unlockKey}`);

  await helpers.dismissKeyguard(driver, adb);
  let keys = helpers.stringKeyToArr(capabilities.unlockKey);

  if ((await adb.getApiLevel()) >= 21) {
    let els = await driver.findElOrEls('id', 'com.android.systemui:id/digit_text', true);

    if (_lodash.default.isEmpty(els)) {
      return await helpers.pinUnlockWithKeyEvent(adb, driver, capabilities);
    }

    let pins = {};

    for (let el of els) {
      let text = await driver.getAttribute('text', _appiumSupport.util.unwrapElement(el));
      pins[text] = el;
    }

    for (let pin of keys) {
      let el = pins[pin];
      await driver.click(_appiumSupport.util.unwrapElement(el));
    }
  } else {
    for (let pin of keys) {
      let el = await driver.findElOrEls('id', `com.android.keyguard:id/key${pin}`, false);

      if (el === null) {
        return await helpers.pinUnlockWithKeyEvent(adb, driver, capabilities);
      }

      await driver.click(_appiumSupport.util.unwrapElement(el));
    }
  }

  await waitForUnlock(adb, driver);
};

async function waitForUnlock(adb, driver) {
  await (0, _asyncbox.sleep)(UNLOCK_WAIT_TIME);

  if (!(await adb.isScreenLocked())) {
    return;
  }

  await driver.pressKeyCode(KEYCODE_NUMPAD_ENTER);
  await (0, _asyncbox.sleep)(UNLOCK_WAIT_TIME);
}

helpers.pinUnlockWithKeyEvent = async function pinUnlockWithKeyEvent(adb, driver, capabilities) {
  _logger.default.info(`Trying to unlock device using pin with keycode ${capabilities.unlockKey}`);

  await helpers.dismissKeyguard(driver, adb);
  const keys = helpers.stringKeyToArr(capabilities.unlockKey);

  for (const pin of keys) {
    await adb.shell(['input', 'keyevent', parseInt(pin, 10) + NUMBER_ZERO_KEYCODE]);
  }

  await waitForUnlock(adb, driver);
};

helpers.passwordUnlock = async function passwordUnlock(adb, driver, capabilities) {
  _logger.default.info(`Trying to unlock device using password ${capabilities.unlockKey}`);

  await helpers.dismissKeyguard(driver, adb);
  let key = capabilities.unlockKey;
  key = helpers.encodePassword(key);
  await adb.shell(['input', 'text', key]);
  await (0, _asyncbox.sleep)(INPUT_KEYS_WAIT_TIME);
  await adb.shell(['input', 'keyevent', KEYCODE_NUMPAD_ENTER]);
  await waitForUnlock(adb, driver);
};

helpers.getPatternKeyPosition = function getPatternKeyPosition(key, initPos, piece) {
  const cols = 3;
  const pins = 9;

  const xPos = (key, x, piece) => Math.round(x + (key % cols || cols) * piece - piece / 2);

  const yPos = (key, y, piece) => Math.round(y + (Math.ceil((key % pins || pins) / cols) * piece - piece / 2));

  return {
    x: xPos(key, initPos.x, piece),
    y: yPos(key, initPos.y, piece)
  };
};

helpers.getPatternActions = function getPatternActions(keys, initPos, piece) {
  let actions = [];
  let lastPos;

  for (let key of keys) {
    let keyPos = helpers.getPatternKeyPosition(key, initPos, piece);

    if (key === keys[0]) {
      actions.push({
        action: 'press',
        options: {
          element: null,
          x: keyPos.x,
          y: keyPos.y
        }
      });
      lastPos = keyPos;
      continue;
    }

    let moveTo = {
      x: 0,
      y: 0
    };
    let diffX = keyPos.x - lastPos.x;

    if (diffX > 0) {
      moveTo.x = piece;

      if (Math.abs(diffX) > piece) {
        moveTo.x += piece;
      }
    } else if (diffX < 0) {
      moveTo.x = -1 * piece;

      if (Math.abs(diffX) > piece) {
        moveTo.x -= piece;
      }
    }

    let diffY = keyPos.y - lastPos.y;

    if (diffY > 0) {
      moveTo.y = piece;

      if (Math.abs(diffY) > piece) {
        moveTo.y += piece;
      }
    } else if (diffY < 0) {
      moveTo.y = -1 * piece;

      if (Math.abs(diffY) > piece) {
        moveTo.y -= piece;
      }
    }

    actions.push({
      action: 'moveTo',
      options: {
        element: null,
        x: moveTo.x + lastPos.x,
        y: moveTo.y + lastPos.y
      }
    });
    lastPos = keyPos;
  }

  actions.push({
    action: 'release'
  });
  return actions;
};

helpers.patternUnlock = async function patternUnlock(adb, driver, capabilities) {
  _logger.default.info(`Trying to unlock device using pattern ${capabilities.unlockKey}`);

  await helpers.dismissKeyguard(driver, adb);
  let keys = helpers.stringKeyToArr(capabilities.unlockKey);
  let apiLevel = await adb.getApiLevel();
  let el = await driver.findElOrEls('id', `com.android.${apiLevel >= 21 ? 'systemui' : 'keyguard'}:id/lockPatternView`, false);
  let initPos = await driver.getLocation(_appiumSupport.util.unwrapElement(el));
  let size = await driver.getSize(_appiumSupport.util.unwrapElement(el));
  let actions = helpers.getPatternActions(keys, initPos, size.width / 3);
  await driver.performTouch(actions);
  await (0, _asyncbox.sleep)(UNLOCK_WAIT_TIME);
};

helpers.PIN_UNLOCK = PIN_UNLOCK;
helpers.PIN_UNLOCK_KEY_EVENT = PIN_UNLOCK_KEY_EVENT;
helpers.PASSWORD_UNLOCK = PASSWORD_UNLOCK;
helpers.PATTERN_UNLOCK = PATTERN_UNLOCK;
helpers.FINGERPRINT_UNLOCK = FINGERPRINT_UNLOCK;
var _default = helpers;
exports.default = _default;require('source-map-support').install();


//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYi91bmxvY2staGVscGVycy5qcyJdLCJuYW1lcyI6WyJQSU5fVU5MT0NLIiwiUElOX1VOTE9DS19LRVlfRVZFTlQiLCJQQVNTV09SRF9VTkxPQ0siLCJQQVRURVJOX1VOTE9DSyIsIkZJTkdFUlBSSU5UX1VOTE9DSyIsIlVOTE9DS19UWVBFUyIsIktFWUNPREVfTlVNUEFEX0VOVEVSIiwiS0VZQ09ERV9QT1dFUiIsIktFWUNPREVfV0FLRVVQIiwiVU5MT0NLX1dBSVRfVElNRSIsIkhJREVfS0VZQk9BUkRfV0FJVF9USU1FIiwiSU5QVVRfS0VZU19XQUlUX1RJTUUiLCJOVU1CRVJfWkVST19LRVlDT0RFIiwiaGVscGVycyIsImlzVmFsaWRVbmxvY2tUeXBlIiwidHlwZSIsImluY2x1ZGVzIiwiaXNWYWxpZEtleSIsImtleSIsIl8iLCJpc1VuZGVmaW5lZCIsInRlc3QiLCJ0cmltIiwiRXJyb3IiLCJkaXNtaXNzS2V5Z3VhcmQiLCJkcml2ZXIiLCJhZGIiLCJsb2dnZXIiLCJpbmZvIiwicHJlc3NLZXlDb2RlIiwiaXNLZXlib2FyZFNob3duIiwiaGlkZUtleWJvYXJkIiwic2hlbGwiLCJiYWNrIiwiZ2V0QXBpTGV2ZWwiLCJzd2lwZVVwIiwid2luZG93U2l6ZSIsImdldFdpbmRvd1NpemUiLCJ4MCIsInBhcnNlSW50IiwieCIsInkwIiwieSIsInlQIiwiYWN0aW9ucyIsImFjdGlvbiIsIm9wdGlvbnMiLCJlbGVtZW50IiwicGVyZm9ybVRvdWNoIiwiZW5jb2RlUGFzc3dvcmQiLCJyZXBsYWNlIiwic3RyaW5nS2V5VG9BcnIiLCJzcGxpdCIsImZpbmdlcnByaW50VW5sb2NrIiwiY2FwYWJpbGl0aWVzIiwiZmluZ2VycHJpbnQiLCJ1bmxvY2tLZXkiLCJwaW5VbmxvY2siLCJrZXlzIiwiZWxzIiwiZmluZEVsT3JFbHMiLCJpc0VtcHR5IiwicGluVW5sb2NrV2l0aEtleUV2ZW50IiwicGlucyIsImVsIiwidGV4dCIsImdldEF0dHJpYnV0ZSIsInV0aWwiLCJ1bndyYXBFbGVtZW50IiwicGluIiwiY2xpY2siLCJ3YWl0Rm9yVW5sb2NrIiwiaXNTY3JlZW5Mb2NrZWQiLCJwYXNzd29yZFVubG9jayIsImdldFBhdHRlcm5LZXlQb3NpdGlvbiIsImluaXRQb3MiLCJwaWVjZSIsImNvbHMiLCJ4UG9zIiwiTWF0aCIsInJvdW5kIiwieVBvcyIsImNlaWwiLCJnZXRQYXR0ZXJuQWN0aW9ucyIsImxhc3RQb3MiLCJrZXlQb3MiLCJwdXNoIiwibW92ZVRvIiwiZGlmZlgiLCJhYnMiLCJkaWZmWSIsInBhdHRlcm5VbmxvY2siLCJhcGlMZXZlbCIsImdldExvY2F0aW9uIiwic2l6ZSIsImdldFNpemUiLCJ3aWR0aCJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxNQUFNQSxVQUFVLEdBQUcsS0FBbkI7O0FBQ0EsTUFBTUMsb0JBQW9CLEdBQUcsaUJBQTdCOztBQUNBLE1BQU1DLGVBQWUsR0FBRyxVQUF4Qjs7QUFDQSxNQUFNQyxjQUFjLEdBQUcsU0FBdkI7O0FBQ0EsTUFBTUMsa0JBQWtCLEdBQUcsYUFBM0I7O0FBQ0EsTUFBTUMsWUFBWSxHQUFHLENBQUNMLFVBQUQsRUFBYUMsb0JBQWIsRUFBbUNDLGVBQW5DLEVBQW9EQyxjQUFwRCxFQUFvRUMsa0JBQXBFLENBQXJCO0FBQ0EsTUFBTUUsb0JBQW9CLEdBQUcsRUFBN0I7QUFDQSxNQUFNQyxhQUFhLEdBQUcsRUFBdEI7QUFDQSxNQUFNQyxjQUFjLEdBQUcsR0FBdkI7QUFDQSxNQUFNQyxnQkFBZ0IsR0FBRyxHQUF6QjtBQUNBLE1BQU1DLHVCQUF1QixHQUFHLEdBQWhDO0FBQ0EsTUFBTUMsb0JBQW9CLEdBQUcsR0FBN0I7QUFDQSxNQUFNQyxtQkFBbUIsR0FBRyxDQUE1QjtBQUVBLElBQUlDLE9BQU8sR0FBRyxFQUFkOzs7QUFDQUEsT0FBTyxDQUFDQyxpQkFBUixHQUE0QixTQUFTQSxpQkFBVCxDQUE0QkMsSUFBNUIsRUFBa0M7QUFDNUQsU0FBT1YsWUFBWSxDQUFDVyxRQUFiLENBQXNCRCxJQUF0QixDQUFQO0FBQ0QsQ0FGRDs7QUFJQUYsT0FBTyxDQUFDSSxVQUFSLEdBQXFCLFNBQVNBLFVBQVQsQ0FBcUJGLElBQXJCLEVBQTJCRyxHQUEzQixFQUFnQztBQUNuRCxNQUFJQyxnQkFBRUMsV0FBRixDQUFjRixHQUFkLENBQUosRUFBd0I7QUFDdEIsV0FBTyxLQUFQO0FBQ0Q7O0FBQ0QsTUFBSSxDQUFDbEIsVUFBRCxFQUFhQyxvQkFBYixFQUFtQ0csa0JBQW5DLEVBQXVEWSxRQUF2RCxDQUFnRUQsSUFBaEUsQ0FBSixFQUEyRTtBQUN6RSxXQUFPLFdBQVdNLElBQVgsQ0FBZ0JILEdBQUcsQ0FBQ0ksSUFBSixFQUFoQixDQUFQO0FBQ0Q7O0FBQ0QsTUFBSVAsSUFBSSxLQUFLWixjQUFiLEVBQTZCO0FBQzNCLFFBQUksQ0FBQyxlQUFla0IsSUFBZixDQUFvQkgsR0FBRyxDQUFDSSxJQUFKLEVBQXBCLENBQUwsRUFBc0M7QUFDcEMsYUFBTyxLQUFQO0FBQ0Q7O0FBQ0QsV0FBTyxDQUFFLGVBQWVELElBQWYsQ0FBb0JILEdBQUcsQ0FBQ0ksSUFBSixFQUFwQixDQUFUO0FBQ0Q7O0FBR0QsTUFBSVAsSUFBSSxLQUFLYixlQUFiLEVBQThCO0FBQzVCLFdBQU8sU0FBU21CLElBQVQsQ0FBY0gsR0FBZCxDQUFQO0FBQ0Q7O0FBQ0QsUUFBTSxJQUFJSyxLQUFKLENBQVcsdUJBQXNCUixJQUFLLEVBQXRDLENBQU47QUFDRCxDQW5CRDs7QUFxQkFGLE9BQU8sQ0FBQ1csZUFBUixHQUEwQixlQUFlQSxlQUFmLENBQWdDQyxNQUFoQyxFQUF3Q0MsR0FBeEMsRUFBNkM7QUFDckVDLGtCQUFPQyxJQUFQLENBQVksbUNBQVo7O0FBR0EsUUFBTUgsTUFBTSxDQUFDSSxZQUFQLENBQW9CdEIsYUFBcEIsQ0FBTjtBQUNBLFFBQU1rQixNQUFNLENBQUNJLFlBQVAsQ0FBb0JyQixjQUFwQixDQUFOO0FBQ0EsTUFBSXNCLGVBQWUsR0FBRyxNQUFNTCxNQUFNLENBQUNLLGVBQVAsRUFBNUI7O0FBQ0EsTUFBSUEsZUFBSixFQUFxQjtBQUNuQixVQUFNTCxNQUFNLENBQUNNLFlBQVAsRUFBTjtBQUVBLFVBQU0scUJBQU1yQix1QkFBTixDQUFOO0FBQ0Q7O0FBRURpQixrQkFBT0MsSUFBUCxDQUFZLHdDQUFaOztBQUNBLFFBQU1GLEdBQUcsQ0FBQ00sS0FBSixDQUFVLENBQUMsU0FBRCxFQUFZLE1BQVosRUFBb0IsY0FBcEIsRUFBb0MsR0FBcEMsQ0FBVixDQUFOO0FBQ0EsUUFBTU4sR0FBRyxDQUFDTyxJQUFKLEVBQU47O0FBQ0EsTUFBSSxPQUFNUCxHQUFHLENBQUNRLFdBQUosRUFBTixJQUEwQixFQUE5QixFQUFrQztBQUNoQ1Asb0JBQU9DLElBQVAsQ0FBWSw0QkFBWjs7QUFDQSxVQUFNRixHQUFHLENBQUNNLEtBQUosQ0FBVSxDQUFDLElBQUQsRUFBTyxrQkFBUCxDQUFWLENBQU47QUFDQTtBQUNEOztBQUNETCxrQkFBT0MsSUFBUCxDQUFZLGdDQUFaOztBQUNBLFFBQU1mLE9BQU8sQ0FBQ3NCLE9BQVIsQ0FBZ0JWLE1BQWhCLENBQU47QUFDRCxDQXZCRDs7QUF5QkFaLE9BQU8sQ0FBQ3NCLE9BQVIsR0FBa0IsZUFBZUEsT0FBZixDQUF3QlYsTUFBeEIsRUFBZ0M7QUFDaEQsTUFBSVcsVUFBVSxHQUFHLE1BQU1YLE1BQU0sQ0FBQ1ksYUFBUCxFQUF2QjtBQUNBLE1BQUlDLEVBQUUsR0FBR0MsUUFBUSxDQUFDSCxVQUFVLENBQUNJLENBQVgsR0FBZSxDQUFoQixFQUFtQixFQUFuQixDQUFqQjtBQUNBLE1BQUlDLEVBQUUsR0FBR0wsVUFBVSxDQUFDTSxDQUFYLEdBQWUsRUFBeEI7QUFDQSxNQUFJQyxFQUFFLEdBQUcsR0FBVDtBQUNBLE1BQUlDLE9BQU8sR0FBRyxDQUNaO0FBQUNDLElBQUFBLE1BQU0sRUFBRSxPQUFUO0FBQWtCQyxJQUFBQSxPQUFPLEVBQUU7QUFBQ0MsTUFBQUEsT0FBTyxFQUFFLElBQVY7QUFBZ0JQLE1BQUFBLENBQUMsRUFBRUYsRUFBbkI7QUFBdUJJLE1BQUFBLENBQUMsRUFBRUQ7QUFBMUI7QUFBM0IsR0FEWSxFQUVaO0FBQUNJLElBQUFBLE1BQU0sRUFBRSxRQUFUO0FBQW1CQyxJQUFBQSxPQUFPLEVBQUU7QUFBQ0MsTUFBQUEsT0FBTyxFQUFFLElBQVY7QUFBZ0JQLE1BQUFBLENBQUMsRUFBRUYsRUFBbkI7QUFBdUJJLE1BQUFBLENBQUMsRUFBRUM7QUFBMUI7QUFBNUIsR0FGWSxFQUdaO0FBQUNFLElBQUFBLE1BQU0sRUFBRTtBQUFULEdBSFksQ0FBZDtBQUtBLFFBQU1wQixNQUFNLENBQUN1QixZQUFQLENBQW9CSixPQUFwQixDQUFOO0FBQ0QsQ0FYRDs7QUFhQS9CLE9BQU8sQ0FBQ29DLGNBQVIsR0FBeUIsU0FBU0EsY0FBVCxDQUF5Qi9CLEdBQXpCLEVBQThCO0FBQ3JELFNBQU9BLEdBQUcsQ0FBQ2dDLE9BQUosQ0FBWSxNQUFaLEVBQW9CLElBQXBCLENBQVA7QUFDRCxDQUZEOztBQUlBckMsT0FBTyxDQUFDc0MsY0FBUixHQUF5QixTQUFTQSxjQUFULENBQXlCakMsR0FBekIsRUFBOEI7QUFDckQsU0FBT0EsR0FBRyxDQUFDSSxJQUFKLEdBQVc0QixPQUFYLENBQW1CLE1BQW5CLEVBQTJCLEVBQTNCLEVBQStCRSxLQUEvQixDQUFxQyxLQUFyQyxDQUFQO0FBQ0QsQ0FGRDs7QUFJQXZDLE9BQU8sQ0FBQ3dDLGlCQUFSLEdBQTRCLGVBQWVBLGlCQUFmLENBQWtDM0IsR0FBbEMsRUFBdUNELE1BQXZDLEVBQStDNkIsWUFBL0MsRUFBNkQ7QUFDdkYsTUFBSSxPQUFNNUIsR0FBRyxDQUFDUSxXQUFKLEVBQU4sSUFBMEIsRUFBOUIsRUFBa0M7QUFDaEMsVUFBTSxJQUFJWCxLQUFKLENBQVUsd0RBQVYsQ0FBTjtBQUNEOztBQUNELFFBQU1HLEdBQUcsQ0FBQzZCLFdBQUosQ0FBZ0JELFlBQVksQ0FBQ0UsU0FBN0IsQ0FBTjtBQUNBLFFBQU0scUJBQU0vQyxnQkFBTixDQUFOO0FBQ0QsQ0FORDs7QUFRQUksT0FBTyxDQUFDNEMsU0FBUixHQUFvQixlQUFlQSxTQUFmLENBQTBCL0IsR0FBMUIsRUFBK0JELE1BQS9CLEVBQXVDNkIsWUFBdkMsRUFBcUQ7QUFDdkUzQixrQkFBT0MsSUFBUCxDQUFhLHFDQUFvQzBCLFlBQVksQ0FBQ0UsU0FBVSxFQUF4RTs7QUFDQSxRQUFNM0MsT0FBTyxDQUFDVyxlQUFSLENBQXdCQyxNQUF4QixFQUFnQ0MsR0FBaEMsQ0FBTjtBQUNBLE1BQUlnQyxJQUFJLEdBQUc3QyxPQUFPLENBQUNzQyxjQUFSLENBQXVCRyxZQUFZLENBQUNFLFNBQXBDLENBQVg7O0FBQ0EsTUFBSSxPQUFNOUIsR0FBRyxDQUFDUSxXQUFKLEVBQU4sS0FBMkIsRUFBL0IsRUFBbUM7QUFDakMsUUFBSXlCLEdBQUcsR0FBRyxNQUFNbEMsTUFBTSxDQUFDbUMsV0FBUCxDQUFtQixJQUFuQixFQUF5QixvQ0FBekIsRUFBK0QsSUFBL0QsQ0FBaEI7O0FBQ0EsUUFBSXpDLGdCQUFFMEMsT0FBRixDQUFVRixHQUFWLENBQUosRUFBb0I7QUFFbEIsYUFBTyxNQUFNOUMsT0FBTyxDQUFDaUQscUJBQVIsQ0FBOEJwQyxHQUE5QixFQUFtQ0QsTUFBbkMsRUFBMkM2QixZQUEzQyxDQUFiO0FBQ0Q7O0FBQ0QsUUFBSVMsSUFBSSxHQUFHLEVBQVg7O0FBQ0EsU0FBSyxJQUFJQyxFQUFULElBQWVMLEdBQWYsRUFBb0I7QUFDbEIsVUFBSU0sSUFBSSxHQUFHLE1BQU14QyxNQUFNLENBQUN5QyxZQUFQLENBQW9CLE1BQXBCLEVBQTRCQyxvQkFBS0MsYUFBTCxDQUFtQkosRUFBbkIsQ0FBNUIsQ0FBakI7QUFDQUQsTUFBQUEsSUFBSSxDQUFDRSxJQUFELENBQUosR0FBYUQsRUFBYjtBQUNEOztBQUNELFNBQUssSUFBSUssR0FBVCxJQUFnQlgsSUFBaEIsRUFBc0I7QUFDcEIsVUFBSU0sRUFBRSxHQUFHRCxJQUFJLENBQUNNLEdBQUQsQ0FBYjtBQUNBLFlBQU01QyxNQUFNLENBQUM2QyxLQUFQLENBQWFILG9CQUFLQyxhQUFMLENBQW1CSixFQUFuQixDQUFiLENBQU47QUFDRDtBQUNGLEdBZkQsTUFlTztBQUNMLFNBQUssSUFBSUssR0FBVCxJQUFnQlgsSUFBaEIsRUFBc0I7QUFDcEIsVUFBSU0sRUFBRSxHQUFHLE1BQU12QyxNQUFNLENBQUNtQyxXQUFQLENBQW1CLElBQW5CLEVBQTBCLDhCQUE2QlMsR0FBSSxFQUEzRCxFQUE4RCxLQUE5RCxDQUFmOztBQUNBLFVBQUlMLEVBQUUsS0FBSyxJQUFYLEVBQWlCO0FBRWYsZUFBTyxNQUFNbkQsT0FBTyxDQUFDaUQscUJBQVIsQ0FBOEJwQyxHQUE5QixFQUFtQ0QsTUFBbkMsRUFBMkM2QixZQUEzQyxDQUFiO0FBQ0Q7O0FBQ0QsWUFBTTdCLE1BQU0sQ0FBQzZDLEtBQVAsQ0FBYUgsb0JBQUtDLGFBQUwsQ0FBbUJKLEVBQW5CLENBQWIsQ0FBTjtBQUNEO0FBQ0Y7O0FBQ0QsUUFBTU8sYUFBYSxDQUFDN0MsR0FBRCxFQUFNRCxNQUFOLENBQW5CO0FBQ0QsQ0E5QkQ7O0FBNENBLGVBQWU4QyxhQUFmLENBQThCN0MsR0FBOUIsRUFBbUNELE1BQW5DLEVBQTJDO0FBQ3pDLFFBQU0scUJBQU1oQixnQkFBTixDQUFOOztBQUNBLE1BQUksRUFBQyxNQUFNaUIsR0FBRyxDQUFDOEMsY0FBSixFQUFQLENBQUosRUFBaUM7QUFDL0I7QUFDRDs7QUFFRCxRQUFNL0MsTUFBTSxDQUFDSSxZQUFQLENBQW9CdkIsb0JBQXBCLENBQU47QUFDQSxRQUFNLHFCQUFNRyxnQkFBTixDQUFOO0FBQ0Q7O0FBRURJLE9BQU8sQ0FBQ2lELHFCQUFSLEdBQWdDLGVBQWVBLHFCQUFmLENBQXNDcEMsR0FBdEMsRUFBMkNELE1BQTNDLEVBQW1ENkIsWUFBbkQsRUFBaUU7QUFDL0YzQixrQkFBT0MsSUFBUCxDQUFhLGtEQUFpRDBCLFlBQVksQ0FBQ0UsU0FBVSxFQUFyRjs7QUFDQSxRQUFNM0MsT0FBTyxDQUFDVyxlQUFSLENBQXdCQyxNQUF4QixFQUFnQ0MsR0FBaEMsQ0FBTjtBQUNBLFFBQU1nQyxJQUFJLEdBQUc3QyxPQUFPLENBQUNzQyxjQUFSLENBQXVCRyxZQUFZLENBQUNFLFNBQXBDLENBQWI7O0FBSUEsT0FBSyxNQUFNYSxHQUFYLElBQWtCWCxJQUFsQixFQUF3QjtBQUd0QixVQUFNaEMsR0FBRyxDQUFDTSxLQUFKLENBQVUsQ0FBQyxPQUFELEVBQVUsVUFBVixFQUFzQk8sUUFBUSxDQUFDOEIsR0FBRCxFQUFNLEVBQU4sQ0FBUixHQUFvQnpELG1CQUExQyxDQUFWLENBQU47QUFDRDs7QUFDRCxRQUFNMkQsYUFBYSxDQUFDN0MsR0FBRCxFQUFNRCxNQUFOLENBQW5CO0FBQ0QsQ0FiRDs7QUFlQVosT0FBTyxDQUFDNEQsY0FBUixHQUF5QixlQUFlQSxjQUFmLENBQStCL0MsR0FBL0IsRUFBb0NELE1BQXBDLEVBQTRDNkIsWUFBNUMsRUFBMEQ7QUFDakYzQixrQkFBT0MsSUFBUCxDQUFhLDBDQUF5QzBCLFlBQVksQ0FBQ0UsU0FBVSxFQUE3RTs7QUFDQSxRQUFNM0MsT0FBTyxDQUFDVyxlQUFSLENBQXdCQyxNQUF4QixFQUFnQ0MsR0FBaEMsQ0FBTjtBQUNBLE1BQUlSLEdBQUcsR0FBR29DLFlBQVksQ0FBQ0UsU0FBdkI7QUFFQXRDLEVBQUFBLEdBQUcsR0FBR0wsT0FBTyxDQUFDb0MsY0FBUixDQUF1Qi9CLEdBQXZCLENBQU47QUFFQSxRQUFNUSxHQUFHLENBQUNNLEtBQUosQ0FBVSxDQUFDLE9BQUQsRUFBVSxNQUFWLEVBQWtCZCxHQUFsQixDQUFWLENBQU47QUFFQSxRQUFNLHFCQUFNUCxvQkFBTixDQUFOO0FBQ0EsUUFBTWUsR0FBRyxDQUFDTSxLQUFKLENBQVUsQ0FBQyxPQUFELEVBQVUsVUFBVixFQUFzQjFCLG9CQUF0QixDQUFWLENBQU47QUFFQSxRQUFNaUUsYUFBYSxDQUFDN0MsR0FBRCxFQUFNRCxNQUFOLENBQW5CO0FBQ0QsQ0FiRDs7QUFlQVosT0FBTyxDQUFDNkQscUJBQVIsR0FBZ0MsU0FBU0EscUJBQVQsQ0FBZ0N4RCxHQUFoQyxFQUFxQ3lELE9BQXJDLEVBQThDQyxLQUE5QyxFQUFxRDtBQU9uRixRQUFNQyxJQUFJLEdBQUcsQ0FBYjtBQUNBLFFBQU1kLElBQUksR0FBRyxDQUFiOztBQUNBLFFBQU1lLElBQUksR0FBRyxDQUFDNUQsR0FBRCxFQUFNc0IsQ0FBTixFQUFTb0MsS0FBVCxLQUFtQkcsSUFBSSxDQUFDQyxLQUFMLENBQVd4QyxDQUFDLEdBQUcsQ0FBRXRCLEdBQUcsR0FBRzJELElBQVAsSUFBZ0JBLElBQWpCLElBQXlCRCxLQUE3QixHQUFxQ0EsS0FBSyxHQUFHLENBQXhELENBQWhDOztBQUNBLFFBQU1LLElBQUksR0FBRyxDQUFDL0QsR0FBRCxFQUFNd0IsQ0FBTixFQUFTa0MsS0FBVCxLQUFtQkcsSUFBSSxDQUFDQyxLQUFMLENBQVd0QyxDQUFDLElBQUlxQyxJQUFJLENBQUNHLElBQUwsQ0FBVSxDQUFFaEUsR0FBRyxHQUFHNkMsSUFBUCxJQUFnQkEsSUFBakIsSUFBeUJjLElBQW5DLElBQTJDRCxLQUEzQyxHQUFtREEsS0FBSyxHQUFHLENBQS9ELENBQVosQ0FBaEM7O0FBQ0EsU0FBTztBQUFDcEMsSUFBQUEsQ0FBQyxFQUFFc0MsSUFBSSxDQUFDNUQsR0FBRCxFQUFNeUQsT0FBTyxDQUFDbkMsQ0FBZCxFQUFpQm9DLEtBQWpCLENBQVI7QUFBaUNsQyxJQUFBQSxDQUFDLEVBQUV1QyxJQUFJLENBQUMvRCxHQUFELEVBQU15RCxPQUFPLENBQUNqQyxDQUFkLEVBQWlCa0MsS0FBakI7QUFBeEMsR0FBUDtBQUNELENBWkQ7O0FBY0EvRCxPQUFPLENBQUNzRSxpQkFBUixHQUE0QixTQUFTQSxpQkFBVCxDQUE0QnpCLElBQTVCLEVBQWtDaUIsT0FBbEMsRUFBMkNDLEtBQTNDLEVBQWtEO0FBQzVFLE1BQUloQyxPQUFPLEdBQUcsRUFBZDtBQUNBLE1BQUl3QyxPQUFKOztBQUNBLE9BQUssSUFBSWxFLEdBQVQsSUFBZ0J3QyxJQUFoQixFQUFzQjtBQUNwQixRQUFJMkIsTUFBTSxHQUFHeEUsT0FBTyxDQUFDNkQscUJBQVIsQ0FBOEJ4RCxHQUE5QixFQUFtQ3lELE9BQW5DLEVBQTRDQyxLQUE1QyxDQUFiOztBQUNBLFFBQUkxRCxHQUFHLEtBQUt3QyxJQUFJLENBQUMsQ0FBRCxDQUFoQixFQUFxQjtBQUNuQmQsTUFBQUEsT0FBTyxDQUFDMEMsSUFBUixDQUFhO0FBQUN6QyxRQUFBQSxNQUFNLEVBQUUsT0FBVDtBQUFrQkMsUUFBQUEsT0FBTyxFQUFFO0FBQUNDLFVBQUFBLE9BQU8sRUFBRSxJQUFWO0FBQWdCUCxVQUFBQSxDQUFDLEVBQUU2QyxNQUFNLENBQUM3QyxDQUExQjtBQUE2QkUsVUFBQUEsQ0FBQyxFQUFFMkMsTUFBTSxDQUFDM0M7QUFBdkM7QUFBM0IsT0FBYjtBQUNBMEMsTUFBQUEsT0FBTyxHQUFHQyxNQUFWO0FBQ0E7QUFDRDs7QUFDRCxRQUFJRSxNQUFNLEdBQUc7QUFBQy9DLE1BQUFBLENBQUMsRUFBRSxDQUFKO0FBQU9FLE1BQUFBLENBQUMsRUFBRTtBQUFWLEtBQWI7QUFDQSxRQUFJOEMsS0FBSyxHQUFHSCxNQUFNLENBQUM3QyxDQUFQLEdBQVc0QyxPQUFPLENBQUM1QyxDQUEvQjs7QUFDQSxRQUFJZ0QsS0FBSyxHQUFHLENBQVosRUFBZTtBQUNiRCxNQUFBQSxNQUFNLENBQUMvQyxDQUFQLEdBQVdvQyxLQUFYOztBQUNBLFVBQUlHLElBQUksQ0FBQ1UsR0FBTCxDQUFTRCxLQUFULElBQWtCWixLQUF0QixFQUE2QjtBQUMzQlcsUUFBQUEsTUFBTSxDQUFDL0MsQ0FBUCxJQUFZb0MsS0FBWjtBQUNEO0FBQ0YsS0FMRCxNQUtPLElBQUlZLEtBQUssR0FBRyxDQUFaLEVBQWU7QUFDcEJELE1BQUFBLE1BQU0sQ0FBQy9DLENBQVAsR0FBVyxDQUFDLENBQUQsR0FBS29DLEtBQWhCOztBQUNBLFVBQUlHLElBQUksQ0FBQ1UsR0FBTCxDQUFTRCxLQUFULElBQWtCWixLQUF0QixFQUE2QjtBQUMzQlcsUUFBQUEsTUFBTSxDQUFDL0MsQ0FBUCxJQUFZb0MsS0FBWjtBQUNEO0FBQ0Y7O0FBQ0QsUUFBSWMsS0FBSyxHQUFHTCxNQUFNLENBQUMzQyxDQUFQLEdBQVcwQyxPQUFPLENBQUMxQyxDQUEvQjs7QUFDQSxRQUFJZ0QsS0FBSyxHQUFHLENBQVosRUFBZTtBQUNiSCxNQUFBQSxNQUFNLENBQUM3QyxDQUFQLEdBQVdrQyxLQUFYOztBQUNBLFVBQUlHLElBQUksQ0FBQ1UsR0FBTCxDQUFTQyxLQUFULElBQWtCZCxLQUF0QixFQUE2QjtBQUMzQlcsUUFBQUEsTUFBTSxDQUFDN0MsQ0FBUCxJQUFZa0MsS0FBWjtBQUNEO0FBQ0YsS0FMRCxNQUtPLElBQUljLEtBQUssR0FBRyxDQUFaLEVBQWU7QUFDcEJILE1BQUFBLE1BQU0sQ0FBQzdDLENBQVAsR0FBVyxDQUFDLENBQUQsR0FBS2tDLEtBQWhCOztBQUNBLFVBQUlHLElBQUksQ0FBQ1UsR0FBTCxDQUFTQyxLQUFULElBQWtCZCxLQUF0QixFQUE2QjtBQUMzQlcsUUFBQUEsTUFBTSxDQUFDN0MsQ0FBUCxJQUFZa0MsS0FBWjtBQUNEO0FBQ0Y7O0FBQ0RoQyxJQUFBQSxPQUFPLENBQUMwQyxJQUFSLENBQWE7QUFBQ3pDLE1BQUFBLE1BQU0sRUFBRSxRQUFUO0FBQW1CQyxNQUFBQSxPQUFPLEVBQUU7QUFBQ0MsUUFBQUEsT0FBTyxFQUFFLElBQVY7QUFBZ0JQLFFBQUFBLENBQUMsRUFBRStDLE1BQU0sQ0FBQy9DLENBQVAsR0FBVzRDLE9BQU8sQ0FBQzVDLENBQXRDO0FBQXlDRSxRQUFBQSxDQUFDLEVBQUU2QyxNQUFNLENBQUM3QyxDQUFQLEdBQVcwQyxPQUFPLENBQUMxQztBQUEvRDtBQUE1QixLQUFiO0FBQ0EwQyxJQUFBQSxPQUFPLEdBQUdDLE1BQVY7QUFDRDs7QUFDRHpDLEVBQUFBLE9BQU8sQ0FBQzBDLElBQVIsQ0FBYTtBQUFDekMsSUFBQUEsTUFBTSxFQUFFO0FBQVQsR0FBYjtBQUNBLFNBQU9ELE9BQVA7QUFDRCxDQXhDRDs7QUEwQ0EvQixPQUFPLENBQUM4RSxhQUFSLEdBQXdCLGVBQWVBLGFBQWYsQ0FBOEJqRSxHQUE5QixFQUFtQ0QsTUFBbkMsRUFBMkM2QixZQUEzQyxFQUF5RDtBQUMvRTNCLGtCQUFPQyxJQUFQLENBQWEseUNBQXdDMEIsWUFBWSxDQUFDRSxTQUFVLEVBQTVFOztBQUNBLFFBQU0zQyxPQUFPLENBQUNXLGVBQVIsQ0FBd0JDLE1BQXhCLEVBQWdDQyxHQUFoQyxDQUFOO0FBQ0EsTUFBSWdDLElBQUksR0FBRzdDLE9BQU8sQ0FBQ3NDLGNBQVIsQ0FBdUJHLFlBQVksQ0FBQ0UsU0FBcEMsQ0FBWDtBQVVBLE1BQUlvQyxRQUFRLEdBQUcsTUFBTWxFLEdBQUcsQ0FBQ1EsV0FBSixFQUFyQjtBQUNBLE1BQUk4QixFQUFFLEdBQUcsTUFBTXZDLE1BQU0sQ0FBQ21DLFdBQVAsQ0FBbUIsSUFBbkIsRUFDWixlQUFjZ0MsUUFBUSxJQUFJLEVBQVosR0FBaUIsVUFBakIsR0FBOEIsVUFBVyxxQkFEM0MsRUFFYixLQUZhLENBQWY7QUFJQSxNQUFJakIsT0FBTyxHQUFHLE1BQU1sRCxNQUFNLENBQUNvRSxXQUFQLENBQW1CMUIsb0JBQUtDLGFBQUwsQ0FBbUJKLEVBQW5CLENBQW5CLENBQXBCO0FBQ0EsTUFBSThCLElBQUksR0FBRyxNQUFNckUsTUFBTSxDQUFDc0UsT0FBUCxDQUFlNUIsb0JBQUtDLGFBQUwsQ0FBbUJKLEVBQW5CLENBQWYsQ0FBakI7QUFFQSxNQUFJcEIsT0FBTyxHQUFHL0IsT0FBTyxDQUFDc0UsaUJBQVIsQ0FBMEJ6QixJQUExQixFQUFnQ2lCLE9BQWhDLEVBQXlDbUIsSUFBSSxDQUFDRSxLQUFMLEdBQWEsQ0FBdEQsQ0FBZDtBQUVBLFFBQU12RSxNQUFNLENBQUN1QixZQUFQLENBQW9CSixPQUFwQixDQUFOO0FBRUEsUUFBTSxxQkFBTW5DLGdCQUFOLENBQU47QUFDRCxDQTFCRDs7QUE0QkFJLE9BQU8sQ0FBQ2IsVUFBUixHQUFxQkEsVUFBckI7QUFDQWEsT0FBTyxDQUFDWixvQkFBUixHQUErQkEsb0JBQS9CO0FBQ0FZLE9BQU8sQ0FBQ1gsZUFBUixHQUEwQkEsZUFBMUI7QUFDQVcsT0FBTyxDQUFDVixjQUFSLEdBQXlCQSxjQUF6QjtBQUNBVSxPQUFPLENBQUNULGtCQUFSLEdBQTZCQSxrQkFBN0I7ZUFHZVMsTyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBsb2dnZXIgZnJvbSAnLi9sb2dnZXInO1xuaW1wb3J0IHsgc2xlZXAgfSBmcm9tICdhc3luY2JveCc7XG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IHsgdXRpbCB9IGZyb20gJ2FwcGl1bS1zdXBwb3J0JztcblxuY29uc3QgUElOX1VOTE9DSyA9ICdwaW4nO1xuY29uc3QgUElOX1VOTE9DS19LRVlfRVZFTlQgPSAncGluV2l0aEtleUV2ZW50JztcbmNvbnN0IFBBU1NXT1JEX1VOTE9DSyA9ICdwYXNzd29yZCc7XG5jb25zdCBQQVRURVJOX1VOTE9DSyA9ICdwYXR0ZXJuJztcbmNvbnN0IEZJTkdFUlBSSU5UX1VOTE9DSyA9ICdmaW5nZXJwcmludCc7XG5jb25zdCBVTkxPQ0tfVFlQRVMgPSBbUElOX1VOTE9DSywgUElOX1VOTE9DS19LRVlfRVZFTlQsIFBBU1NXT1JEX1VOTE9DSywgUEFUVEVSTl9VTkxPQ0ssIEZJTkdFUlBSSU5UX1VOTE9DS107XG5jb25zdCBLRVlDT0RFX05VTVBBRF9FTlRFUiA9IDY2O1xuY29uc3QgS0VZQ09ERV9QT1dFUiA9IDI2O1xuY29uc3QgS0VZQ09ERV9XQUtFVVAgPSAyMjQ7IC8vIENhbiB3b3JrIG92ZXIgQVBJIExldmVsIDIwXG5jb25zdCBVTkxPQ0tfV0FJVF9USU1FID0gMTAwO1xuY29uc3QgSElERV9LRVlCT0FSRF9XQUlUX1RJTUUgPSAxMDA7XG5jb25zdCBJTlBVVF9LRVlTX1dBSVRfVElNRSA9IDEwMDtcbmNvbnN0IE5VTUJFUl9aRVJPX0tFWUNPREUgPSA3O1xuXG5sZXQgaGVscGVycyA9IHt9O1xuaGVscGVycy5pc1ZhbGlkVW5sb2NrVHlwZSA9IGZ1bmN0aW9uIGlzVmFsaWRVbmxvY2tUeXBlICh0eXBlKSB7XG4gIHJldHVybiBVTkxPQ0tfVFlQRVMuaW5jbHVkZXModHlwZSk7XG59O1xuXG5oZWxwZXJzLmlzVmFsaWRLZXkgPSBmdW5jdGlvbiBpc1ZhbGlkS2V5ICh0eXBlLCBrZXkpIHtcbiAgaWYgKF8uaXNVbmRlZmluZWQoa2V5KSkge1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuICBpZiAoW1BJTl9VTkxPQ0ssIFBJTl9VTkxPQ0tfS0VZX0VWRU5ULCBGSU5HRVJQUklOVF9VTkxPQ0tdLmluY2x1ZGVzKHR5cGUpKSB7XG4gICAgcmV0dXJuIC9eWzAtOV0rJC8udGVzdChrZXkudHJpbSgpKTtcbiAgfVxuICBpZiAodHlwZSA9PT0gUEFUVEVSTl9VTkxPQ0spIHtcbiAgICBpZiAoIS9eWzEtOV17Miw5fSQvLnRlc3Qoa2V5LnRyaW0oKSkpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuICEoLyhbMS05XSkuKj9cXDEvLnRlc3Qoa2V5LnRyaW0oKSkpO1xuICB9XG4gIC8vIERvbnQgdHJpbSBwYXNzd29yZCBrZXksIHlvdSBjYW4gdXNlIGJsYW5rIHNwYWNlcyBpbiB5b3VyIGFuZHJvaWQgcGFzc3dvcmRcbiAgLy8gwq9cXF8o44OEKV8vwq9cbiAgaWYgKHR5cGUgPT09IFBBU1NXT1JEX1VOTE9DSykge1xuICAgIHJldHVybiAvLns0LH0vZy50ZXN0KGtleSk7XG4gIH1cbiAgdGhyb3cgbmV3IEVycm9yKGBJbnZhbGlkIHVubG9jayB0eXBlICR7dHlwZX1gKTtcbn07XG5cbmhlbHBlcnMuZGlzbWlzc0tleWd1YXJkID0gYXN5bmMgZnVuY3Rpb24gZGlzbWlzc0tleWd1YXJkIChkcml2ZXIsIGFkYikge1xuICBsb2dnZXIuaW5mbygnV2FraW5nIHVwIHRoZSBkZXZpY2UgdG8gdW5sb2NrIGl0Jyk7XG4gIC8vIFNjcmVlbiBvZmYgb25jZSB0byBmb3JjZSBwcmUtaW5wdXR0ZWQgdGV4dCBmaWVsZCBjbGVhbiBhZnRlciB3YWtlLXVwXG4gIC8vIEp1c3Qgc2NyZWVuIG9uIGlmIHRoZSBzY3JlZW4gZGVmYXVsdHMgb2ZmXG4gIGF3YWl0IGRyaXZlci5wcmVzc0tleUNvZGUoS0VZQ09ERV9QT1dFUik7XG4gIGF3YWl0IGRyaXZlci5wcmVzc0tleUNvZGUoS0VZQ09ERV9XQUtFVVApO1xuICBsZXQgaXNLZXlib2FyZFNob3duID0gYXdhaXQgZHJpdmVyLmlzS2V5Ym9hcmRTaG93bigpO1xuICBpZiAoaXNLZXlib2FyZFNob3duKSB7XG4gICAgYXdhaXQgZHJpdmVyLmhpZGVLZXlib2FyZCgpO1xuICAgIC8vIFdhaXRzIGEgYml0IGZvciB0aGUga2V5Ym9hcmQgdG8gaGlkZVxuICAgIGF3YWl0IHNsZWVwKEhJREVfS0VZQk9BUkRfV0FJVF9USU1FKTtcbiAgfVxuICAvLyBkaXNtaXNzIG5vdGlmaWNhdGlvbnNcbiAgbG9nZ2VyLmluZm8oJ0Rpc21pc3Mgbm90aWZpY2F0aW9ucyBmcm9tIHVubG9jayB2aWV3Jyk7XG4gIGF3YWl0IGFkYi5zaGVsbChbJ3NlcnZpY2UnLCAnY2FsbCcsICdub3RpZmljYXRpb24nLCAnMSddKTtcbiAgYXdhaXQgYWRiLmJhY2soKTtcbiAgaWYgKGF3YWl0IGFkYi5nZXRBcGlMZXZlbCgpID4gMjEpIHtcbiAgICBsb2dnZXIuaW5mbygnVHJ5aW5nIHRvIGRpc21pc3Mga2V5Z3VhcmQnKTtcbiAgICBhd2FpdCBhZGIuc2hlbGwoWyd3bScsICdkaXNtaXNzLWtleWd1YXJkJ10pO1xuICAgIHJldHVybjtcbiAgfVxuICBsb2dnZXIuaW5mbygnU3dpcGluZyB1cCB0byBkaXNtaXNzIGtleWd1YXJkJyk7XG4gIGF3YWl0IGhlbHBlcnMuc3dpcGVVcChkcml2ZXIpO1xufTtcblxuaGVscGVycy5zd2lwZVVwID0gYXN5bmMgZnVuY3Rpb24gc3dpcGVVcCAoZHJpdmVyKSB7XG4gIGxldCB3aW5kb3dTaXplID0gYXdhaXQgZHJpdmVyLmdldFdpbmRvd1NpemUoKTtcbiAgbGV0IHgwID0gcGFyc2VJbnQod2luZG93U2l6ZS54IC8gMiwgMTApO1xuICBsZXQgeTAgPSB3aW5kb3dTaXplLnkgLSAxMDtcbiAgbGV0IHlQID0gMTAwO1xuICBsZXQgYWN0aW9ucyA9IFtcbiAgICB7YWN0aW9uOiAncHJlc3MnLCBvcHRpb25zOiB7ZWxlbWVudDogbnVsbCwgeDogeDAsIHk6IHkwfX0sXG4gICAge2FjdGlvbjogJ21vdmVUbycsIG9wdGlvbnM6IHtlbGVtZW50OiBudWxsLCB4OiB4MCwgeTogeVB9fSxcbiAgICB7YWN0aW9uOiAncmVsZWFzZSd9XG4gIF07XG4gIGF3YWl0IGRyaXZlci5wZXJmb3JtVG91Y2goYWN0aW9ucyk7XG59O1xuXG5oZWxwZXJzLmVuY29kZVBhc3N3b3JkID0gZnVuY3Rpb24gZW5jb2RlUGFzc3dvcmQgKGtleSkge1xuICByZXR1cm4ga2V5LnJlcGxhY2UoL1xccy9pZywgJyVzJyk7XG59O1xuXG5oZWxwZXJzLnN0cmluZ0tleVRvQXJyID0gZnVuY3Rpb24gc3RyaW5nS2V5VG9BcnIgKGtleSkge1xuICByZXR1cm4ga2V5LnRyaW0oKS5yZXBsYWNlKC9cXHMrL2csICcnKS5zcGxpdCgvXFxzKi8pO1xufTtcblxuaGVscGVycy5maW5nZXJwcmludFVubG9jayA9IGFzeW5jIGZ1bmN0aW9uIGZpbmdlcnByaW50VW5sb2NrIChhZGIsIGRyaXZlciwgY2FwYWJpbGl0aWVzKSB7XG4gIGlmIChhd2FpdCBhZGIuZ2V0QXBpTGV2ZWwoKSA8IDIzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGaW5nZXJwcmludCB1bmxvY2sgb25seSB3b3JrcyBmb3IgQW5kcm9pZCA2KyBlbXVsYXRvcnMnKTtcbiAgfVxuICBhd2FpdCBhZGIuZmluZ2VycHJpbnQoY2FwYWJpbGl0aWVzLnVubG9ja0tleSk7XG4gIGF3YWl0IHNsZWVwKFVOTE9DS19XQUlUX1RJTUUpO1xufTtcblxuaGVscGVycy5waW5VbmxvY2sgPSBhc3luYyBmdW5jdGlvbiBwaW5VbmxvY2sgKGFkYiwgZHJpdmVyLCBjYXBhYmlsaXRpZXMpIHtcbiAgbG9nZ2VyLmluZm8oYFRyeWluZyB0byB1bmxvY2sgZGV2aWNlIHVzaW5nIHBpbiAke2NhcGFiaWxpdGllcy51bmxvY2tLZXl9YCk7XG4gIGF3YWl0IGhlbHBlcnMuZGlzbWlzc0tleWd1YXJkKGRyaXZlciwgYWRiKTtcbiAgbGV0IGtleXMgPSBoZWxwZXJzLnN0cmluZ0tleVRvQXJyKGNhcGFiaWxpdGllcy51bmxvY2tLZXkpO1xuICBpZiAoYXdhaXQgYWRiLmdldEFwaUxldmVsKCkgPj0gMjEpIHtcbiAgICBsZXQgZWxzID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCdpZCcsICdjb20uYW5kcm9pZC5zeXN0ZW11aTppZC9kaWdpdF90ZXh0JywgdHJ1ZSk7XG4gICAgaWYgKF8uaXNFbXB0eShlbHMpKSB7XG4gICAgICAvLyBmYWxsYmFjayB0byBwaW4gd2l0aCBrZXkgZXZlbnRcbiAgICAgIHJldHVybiBhd2FpdCBoZWxwZXJzLnBpblVubG9ja1dpdGhLZXlFdmVudChhZGIsIGRyaXZlciwgY2FwYWJpbGl0aWVzKTtcbiAgICB9XG4gICAgbGV0IHBpbnMgPSB7fTtcbiAgICBmb3IgKGxldCBlbCBvZiBlbHMpIHtcbiAgICAgIGxldCB0ZXh0ID0gYXdhaXQgZHJpdmVyLmdldEF0dHJpYnV0ZSgndGV4dCcsIHV0aWwudW53cmFwRWxlbWVudChlbCkpO1xuICAgICAgcGluc1t0ZXh0XSA9IGVsO1xuICAgIH1cbiAgICBmb3IgKGxldCBwaW4gb2Yga2V5cykge1xuICAgICAgbGV0IGVsID0gcGluc1twaW5dO1xuICAgICAgYXdhaXQgZHJpdmVyLmNsaWNrKHV0aWwudW53cmFwRWxlbWVudChlbCkpO1xuICAgIH1cbiAgfSBlbHNlIHtcbiAgICBmb3IgKGxldCBwaW4gb2Yga2V5cykge1xuICAgICAgbGV0IGVsID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCdpZCcsIGBjb20uYW5kcm9pZC5rZXlndWFyZDppZC9rZXkke3Bpbn1gLCBmYWxzZSk7XG4gICAgICBpZiAoZWwgPT09IG51bGwpIHtcbiAgICAgICAgLy8gZmFsbGJhY2sgdG8gcGluIHdpdGgga2V5IGV2ZW50XG4gICAgICAgIHJldHVybiBhd2FpdCBoZWxwZXJzLnBpblVubG9ja1dpdGhLZXlFdmVudChhZGIsIGRyaXZlciwgY2FwYWJpbGl0aWVzKTtcbiAgICAgIH1cbiAgICAgIGF3YWl0IGRyaXZlci5jbGljayh1dGlsLnVud3JhcEVsZW1lbnQoZWwpKTtcbiAgICB9XG4gIH1cbiAgYXdhaXQgd2FpdEZvclVubG9jayhhZGIsIGRyaXZlcik7XG59O1xuXG5cbi8qKlxuICogV2FpdCBmb3IgdGhlIGRpc3BsYXkgdG8gYmUgdW5sb2NrZWQuXG4gKiBTb21lIGRldmljZXMgYXV0b21hdGljYWxseSBhY2NlcHQgdHlwZWQgJ3BpbicgYW5kICdwYXNzd29yZCcgY29kZVxuICogd2l0aG91dCBwcmVzc2luZyB0aGUgRW50ZXIga2V5LiBCdXQgc29tZSBkZXZpY2VzIG5lZWQgaXQuXG4gKiBUaGlzIG1ldGhvZCB3YWl0cyBhIGZldyBzZWNvbmRzIGZpcnN0IGZvciBzdWNoIGF1dG9tYXRpYyBhY2NlcHRhbmNlIGNhc2UuXG4gKiBJZiB0aGUgZGV2aWNlIGlzIHN0aWxsIGxvY2tlZCwgdGhlbiB0aGlzIG1ldGhvZCB3aWxsIHRyeSB0byBzZW5kXG4gKiB0aGUgZW50ZXIga2V5IGNvZGUuXG4gKlxuICogQHBhcmFtIHtBREJ9IGFkYiBUaGUgaW5zdGFuY2Ugb2YgQURCXG4gKiBAcGFyYW0ge0FuZHJvaWREcml2ZXJ9IGRyaXZlciBUaGUgaW5zdGFuY2Ugb2YgQW5kcm9pZERyaXZlclxuICovXG5hc3luYyBmdW5jdGlvbiB3YWl0Rm9yVW5sb2NrIChhZGIsIGRyaXZlcikge1xuICBhd2FpdCBzbGVlcChVTkxPQ0tfV0FJVF9USU1FKTtcbiAgaWYgKCFhd2FpdCBhZGIuaXNTY3JlZW5Mb2NrZWQoKSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGF3YWl0IGRyaXZlci5wcmVzc0tleUNvZGUoS0VZQ09ERV9OVU1QQURfRU5URVIpO1xuICBhd2FpdCBzbGVlcChVTkxPQ0tfV0FJVF9USU1FKTtcbn1cblxuaGVscGVycy5waW5VbmxvY2tXaXRoS2V5RXZlbnQgPSBhc3luYyBmdW5jdGlvbiBwaW5VbmxvY2tXaXRoS2V5RXZlbnQgKGFkYiwgZHJpdmVyLCBjYXBhYmlsaXRpZXMpIHtcbiAgbG9nZ2VyLmluZm8oYFRyeWluZyB0byB1bmxvY2sgZGV2aWNlIHVzaW5nIHBpbiB3aXRoIGtleWNvZGUgJHtjYXBhYmlsaXRpZXMudW5sb2NrS2V5fWApO1xuICBhd2FpdCBoZWxwZXJzLmRpc21pc3NLZXlndWFyZChkcml2ZXIsIGFkYik7XG4gIGNvbnN0IGtleXMgPSBoZWxwZXJzLnN0cmluZ0tleVRvQXJyKGNhcGFiaWxpdGllcy51bmxvY2tLZXkpO1xuXG4gIC8vIFNvbWUgZGV2aWNlIGRvZXMgbm90IGhhdmUgc3lzdGVtIGtleSBpZHMgbGlrZSAnY29tLmFuZHJvaWQua2V5Z3VhcmQ6aWQva2V5J1xuICAvLyBUaGVuLCBzZW5kaW5nIGtleWV2ZW50cyBhcmUgbW9yZSByZWxpYWJsZSB0byB1bmxvY2sgdGhlIHNjcmVlbi5cbiAgZm9yIChjb25zdCBwaW4gb2Yga2V5cykge1xuICAgIC8vICdwaW4nIGlzIG51bWJlciAoMC05KSBpbiBzdHJpbmcuXG4gICAgLy8gTnVtYmVyICcwJyBpcyBrZXljb2RlICc3Jy4gbnVtYmVyICc5JyBpcyBrZXljb2RlICcxNicuXG4gICAgYXdhaXQgYWRiLnNoZWxsKFsnaW5wdXQnLCAna2V5ZXZlbnQnLCBwYXJzZUludChwaW4sIDEwKSArIE5VTUJFUl9aRVJPX0tFWUNPREVdKTtcbiAgfVxuICBhd2FpdCB3YWl0Rm9yVW5sb2NrKGFkYiwgZHJpdmVyKTtcbn07XG5cbmhlbHBlcnMucGFzc3dvcmRVbmxvY2sgPSBhc3luYyBmdW5jdGlvbiBwYXNzd29yZFVubG9jayAoYWRiLCBkcml2ZXIsIGNhcGFiaWxpdGllcykge1xuICBsb2dnZXIuaW5mbyhgVHJ5aW5nIHRvIHVubG9jayBkZXZpY2UgdXNpbmcgcGFzc3dvcmQgJHtjYXBhYmlsaXRpZXMudW5sb2NrS2V5fWApO1xuICBhd2FpdCBoZWxwZXJzLmRpc21pc3NLZXlndWFyZChkcml2ZXIsIGFkYik7XG4gIGxldCBrZXkgPSBjYXBhYmlsaXRpZXMudW5sb2NrS2V5O1xuICAvLyBSZXBsYWNlIGJsYW5rIHNwYWNlcyB3aXRoICVzXG4gIGtleSA9IGhlbHBlcnMuZW5jb2RlUGFzc3dvcmQoa2V5KTtcbiAgLy8gV2h5IGFkYiA/IEl0IHdhcyBsZXNzIGZsYWt5XG4gIGF3YWl0IGFkYi5zaGVsbChbJ2lucHV0JywgJ3RleHQnLCBrZXldKTtcbiAgLy8gV2h5IHNsZWVwcyA/IEF2b2lkIHNvbWUgZmxha3luZXNzIHdhaXRpbmcgZm9yIHRoZSBpbnB1dCB0byByZWNlaXZlIHRoZSBrZXlzXG4gIGF3YWl0IHNsZWVwKElOUFVUX0tFWVNfV0FJVF9USU1FKTtcbiAgYXdhaXQgYWRiLnNoZWxsKFsnaW5wdXQnLCAna2V5ZXZlbnQnLCBLRVlDT0RFX05VTVBBRF9FTlRFUl0pO1xuICAvLyBXYWl0cyBhIGJpdCBmb3IgdGhlIGRldmljZSB0byBiZSB1bmxvY2tlZFxuICBhd2FpdCB3YWl0Rm9yVW5sb2NrKGFkYiwgZHJpdmVyKTtcbn07XG5cbmhlbHBlcnMuZ2V0UGF0dGVybktleVBvc2l0aW9uID0gZnVuY3Rpb24gZ2V0UGF0dGVybktleVBvc2l0aW9uIChrZXksIGluaXRQb3MsIHBpZWNlKSB7XG4gIC8qXG4gIEhvdyB0aGUgbWF0aCB3b3JrczpcbiAgV2UgaGF2ZSA5IGJ1dHRvbnMgZGl2aWRlZCBpbiAzIGNvbHVtbnMgYW5kIDMgcm93cyBpbnNpZGUgdGhlIGxvY2tQYXR0ZXJuVmlldyxcbiAgZXZlcnkgYnV0dG9uIGhhcyBhIHBvc2l0aW9uIG9uIHRoZSBzY3JlZW4gY29ycmVzcG9uZGluZyB0byB0aGUgbG9ja1BhdHRlcm5WaWV3IHNpbmNlXG4gIGl0IGlzIHRoZSBwYXJlbnQgdmlldyByaWdodCBhdCB0aGUgbWlkZGxlIG9mIGVhY2ggY29sdW1uIG9yIHJvdy5cbiAgKi9cbiAgY29uc3QgY29scyA9IDM7XG4gIGNvbnN0IHBpbnMgPSA5O1xuICBjb25zdCB4UG9zID0gKGtleSwgeCwgcGllY2UpID0+IE1hdGgucm91bmQoeCArICgoa2V5ICUgY29scykgfHwgY29scykgKiBwaWVjZSAtIHBpZWNlIC8gMik7XG4gIGNvbnN0IHlQb3MgPSAoa2V5LCB5LCBwaWVjZSkgPT4gTWF0aC5yb3VuZCh5ICsgKE1hdGguY2VpbCgoKGtleSAlIHBpbnMpIHx8IHBpbnMpIC8gY29scykgKiBwaWVjZSAtIHBpZWNlIC8gMikpO1xuICByZXR1cm4ge3g6IHhQb3Moa2V5LCBpbml0UG9zLngsIHBpZWNlKSwgeTogeVBvcyhrZXksIGluaXRQb3MueSwgcGllY2UpfTtcbn07XG5cbmhlbHBlcnMuZ2V0UGF0dGVybkFjdGlvbnMgPSBmdW5jdGlvbiBnZXRQYXR0ZXJuQWN0aW9ucyAoa2V5cywgaW5pdFBvcywgcGllY2UpIHtcbiAgbGV0IGFjdGlvbnMgPSBbXTtcbiAgbGV0IGxhc3RQb3M7XG4gIGZvciAobGV0IGtleSBvZiBrZXlzKSB7XG4gICAgbGV0IGtleVBvcyA9IGhlbHBlcnMuZ2V0UGF0dGVybktleVBvc2l0aW9uKGtleSwgaW5pdFBvcywgcGllY2UpO1xuICAgIGlmIChrZXkgPT09IGtleXNbMF0pIHtcbiAgICAgIGFjdGlvbnMucHVzaCh7YWN0aW9uOiAncHJlc3MnLCBvcHRpb25zOiB7ZWxlbWVudDogbnVsbCwgeDoga2V5UG9zLngsIHk6IGtleVBvcy55fX0pO1xuICAgICAgbGFzdFBvcyA9IGtleVBvcztcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICBsZXQgbW92ZVRvID0ge3g6IDAsIHk6IDB9O1xuICAgIGxldCBkaWZmWCA9IGtleVBvcy54IC0gbGFzdFBvcy54O1xuICAgIGlmIChkaWZmWCA+IDApIHtcbiAgICAgIG1vdmVUby54ID0gcGllY2U7XG4gICAgICBpZiAoTWF0aC5hYnMoZGlmZlgpID4gcGllY2UpIHtcbiAgICAgICAgbW92ZVRvLnggKz0gcGllY2U7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChkaWZmWCA8IDApIHtcbiAgICAgIG1vdmVUby54ID0gLTEgKiBwaWVjZTtcbiAgICAgIGlmIChNYXRoLmFicyhkaWZmWCkgPiBwaWVjZSkge1xuICAgICAgICBtb3ZlVG8ueCAtPSBwaWVjZTtcbiAgICAgIH1cbiAgICB9XG4gICAgbGV0IGRpZmZZID0ga2V5UG9zLnkgLSBsYXN0UG9zLnk7XG4gICAgaWYgKGRpZmZZID4gMCkge1xuICAgICAgbW92ZVRvLnkgPSBwaWVjZTtcbiAgICAgIGlmIChNYXRoLmFicyhkaWZmWSkgPiBwaWVjZSkge1xuICAgICAgICBtb3ZlVG8ueSArPSBwaWVjZTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGRpZmZZIDwgMCkge1xuICAgICAgbW92ZVRvLnkgPSAtMSAqIHBpZWNlO1xuICAgICAgaWYgKE1hdGguYWJzKGRpZmZZKSA+IHBpZWNlKSB7XG4gICAgICAgIG1vdmVUby55IC09IHBpZWNlO1xuICAgICAgfVxuICAgIH1cbiAgICBhY3Rpb25zLnB1c2goe2FjdGlvbjogJ21vdmVUbycsIG9wdGlvbnM6IHtlbGVtZW50OiBudWxsLCB4OiBtb3ZlVG8ueCArIGxhc3RQb3MueCwgeTogbW92ZVRvLnkgKyBsYXN0UG9zLnl9fSk7XG4gICAgbGFzdFBvcyA9IGtleVBvcztcbiAgfVxuICBhY3Rpb25zLnB1c2goe2FjdGlvbjogJ3JlbGVhc2UnfSk7XG4gIHJldHVybiBhY3Rpb25zO1xufTtcblxuaGVscGVycy5wYXR0ZXJuVW5sb2NrID0gYXN5bmMgZnVuY3Rpb24gcGF0dGVyblVubG9jayAoYWRiLCBkcml2ZXIsIGNhcGFiaWxpdGllcykge1xuICBsb2dnZXIuaW5mbyhgVHJ5aW5nIHRvIHVubG9jayBkZXZpY2UgdXNpbmcgcGF0dGVybiAke2NhcGFiaWxpdGllcy51bmxvY2tLZXl9YCk7XG4gIGF3YWl0IGhlbHBlcnMuZGlzbWlzc0tleWd1YXJkKGRyaXZlciwgYWRiKTtcbiAgbGV0IGtleXMgPSBoZWxwZXJzLnN0cmluZ0tleVRvQXJyKGNhcGFiaWxpdGllcy51bmxvY2tLZXkpO1xuICAvKiBXZSBzZXQgdGhlIGRldmljZSBwYXR0ZXJuIGJ1dHRvbnMgYXMgbnVtYmVyIG9mIGEgcmVndWxhciBwaG9uZVxuICAgKiAgfCDigKIg4oCiIOKAoiB8ICAgICB8IDEgMiAzIHxcbiAgICogIHwg4oCiIOKAoiDigKIgfCAtLT4gfCA0IDUgNiB8XG4gICAqICB8IOKAoiDigKIg4oCiIHwgICAgIHwgNyA4IDkgfFxuXG4gIFRoZSBwYXR0ZXJuIHZpZXcgYnV0dG9ucyBhcmUgbm90IHNlZWluZyBieSB0aGUgdWlhdXRvbWF0b3Igc2luY2UgdGhleSBhcmVcbiAgaW5jbHVkZWQgaW5zaWRlIGEgRnJhbWVMYXlvdXQsIHNvIHdlIGFyZSBnb2luZyB0byB0cnkgY2xpY2tpbmcgb24gdGhlIGJ1dHRvbnNcbiAgdXNpbmcgdGhlIHBhcmVudCB2aWV3IGJvdW5kcyBhbmQgbWF0aC5cbiAgKi9cbiAgbGV0IGFwaUxldmVsID0gYXdhaXQgYWRiLmdldEFwaUxldmVsKCk7XG4gIGxldCBlbCA9IGF3YWl0IGRyaXZlci5maW5kRWxPckVscygnaWQnLFxuICAgIGBjb20uYW5kcm9pZC4ke2FwaUxldmVsID49IDIxID8gJ3N5c3RlbXVpJyA6ICdrZXlndWFyZCd9OmlkL2xvY2tQYXR0ZXJuVmlld2AsXG4gICAgZmFsc2VcbiAgKTtcbiAgbGV0IGluaXRQb3MgPSBhd2FpdCBkcml2ZXIuZ2V0TG9jYXRpb24odXRpbC51bndyYXBFbGVtZW50KGVsKSk7XG4gIGxldCBzaXplID0gYXdhaXQgZHJpdmVyLmdldFNpemUodXRpbC51bndyYXBFbGVtZW50KGVsKSk7XG4gIC8vIEdldCBhY3Rpb25zIHRvIHBlcmZvcm1cbiAgbGV0IGFjdGlvbnMgPSBoZWxwZXJzLmdldFBhdHRlcm5BY3Rpb25zKGtleXMsIGluaXRQb3MsIHNpemUud2lkdGggLyAzKTtcbiAgLy8gUGVyZm9ybSBnZXN0dXJlXG4gIGF3YWl0IGRyaXZlci5wZXJmb3JtVG91Y2goYWN0aW9ucyk7XG4gIC8vIFdhaXRzIGEgYml0IGZvciB0aGUgZGV2aWNlIHRvIGJlIHVubG9ja2VkXG4gIGF3YWl0IHNsZWVwKFVOTE9DS19XQUlUX1RJTUUpO1xufTtcblxuaGVscGVycy5QSU5fVU5MT0NLID0gUElOX1VOTE9DSztcbmhlbHBlcnMuUElOX1VOTE9DS19LRVlfRVZFTlQgPSBQSU5fVU5MT0NLX0tFWV9FVkVOVDtcbmhlbHBlcnMuUEFTU1dPUkRfVU5MT0NLID0gUEFTU1dPUkRfVU5MT0NLO1xuaGVscGVycy5QQVRURVJOX1VOTE9DSyA9IFBBVFRFUk5fVU5MT0NLO1xuaGVscGVycy5GSU5HRVJQUklOVF9VTkxPQ0sgPSBGSU5HRVJQUklOVF9VTkxPQ0s7XG5cbmV4cG9ydCB7IFBJTl9VTkxPQ0ssIFBJTl9VTkxPQ0tfS0VZX0VWRU5ULCBQQVNTV09SRF9VTkxPQ0ssIFBBVFRFUk5fVU5MT0NLLCBGSU5HRVJQUklOVF9VTkxPQ0ssIGhlbHBlcnMgfTtcbmV4cG9ydCBkZWZhdWx0IGhlbHBlcnM7XG4iXSwiZmlsZSI6ImxpYi91bmxvY2staGVscGVycy5qcyIsInNvdXJjZVJvb3QiOiIuLi8uLiJ9
